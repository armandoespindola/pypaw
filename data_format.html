<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Data Format and Conversion &mdash; pypaw 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pypaw 0.0.1 documentation" href="index.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial.html" title="Tutorial"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pypaw 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="data-format-and-conversion">
<h1>Data Format and Conversion<a class="headerlink" href="#data-format-and-conversion" title="Permalink to this headline">¶</a></h1>
<p>** This part requires you to have some basic knowledge about <a class="reference external" href="https://github.com/obspy/obspy/wiki">Obspy</a> and <a class="reference external" href="http://seismicdata.github.io/pyasdf/">Pyasdf</a>.</p>
<div class="section" id="data-format">
<h2>1. Data Format<a class="headerlink" href="#data-format" title="Permalink to this headline">¶</a></h2>
<p>The data format here we used is <a class="reference external" href="https://github.com/SeismicData">ASDF</a>. If you are not familiar with this data format, please have a look at this link: <a class="reference external" href="http://asdf.readthedocs.org/en/latest/index.html">ASDF</a>.</p>
<p>The ASDf is developed with many great features. But here I will mention two of them:</p>
<ol class="arabic">
<li><p class="first">One asdf file contains the complimentary information for general purpose processing, including the waveform, StationXML and event information. You can add as many as waveforms you want, for example, all data for one event could be stored in a single ASDF file.</p>
<p>To compare with <em>sac</em>, people usually need to store with SAC(waveform), RESPONSE file and event file separatly. The number of files are large and usually stored at different places. This kind of directory complexity increase the possiblities of making erros dramatically.</p>
</li>
<li><p class="first">It has internal support for parallel computation, which is very easy to use and reduce the processing time by a factor of number of processors.</p>
</li>
</ol>
<p>For more features of asdf, please take a look at the offcial doc of ASDF project.</p>
</div>
<div class="section" id="data-conversion">
<h2>2. Data Conversion<a class="headerlink" href="#data-conversion" title="Permalink to this headline">¶</a></h2>
<p>The data conversion to ASDF is simple, with the tools provided by Pyasdf. A detailed instruction could be found in <a class="reference external" href="http://seismicdata.github.io/pyasdf/tutorial.html#creating-an-asdf-data-set">pyasdf</a>. Here, for user&#8217;s simplicity, I created an tool for easy data conversion.</p>
<p><strong>1. Data requirements</strong>:</p>
<ol class="arabic simple">
<li><strong>Waveform data</strong>: any data format supported by <a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.read.html">obspy</a> could be used as waveform data.</li>
<li><strong>Quakeml file</strong>: Quakeml file that contains event information.</li>
<li><strong>StationXML files(*optional*)</strong>: StationXML files are reuquired here if you want to extrace station information, for example, station location and instrument response information.<ul>
<li>For observed data, including StationXML files into For people using SAC, they are familiar with RESPONSE or POLES_AND_ZEROS files.</li>
<li>For synthetic data, you don&#8217;t need the response information you don&#8217;t need to include the StationXMl files. You could create you own StationXML in memory(no real I/O) and add them into the ASDF file. For example, in you are using SAC, if station location information are already stored in the SAC header, you don&#8217;t need to bother with StationXML files. Pypaw will help you automatically extract station information and store them into ASDF file.</li>
</ul>
</li>
</ol>
<p><strong>2. Conversion to ASDF</strong></p>
<p>Once the data is ready, then you can start to convert them into ASDF file.
You need to prepare a path file to specify the path of waveforms, stationxmls and quakeml.</p>
<p>For example, for observed data in MSEED, the path file(in json format):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;waveform_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/observed/waveform/dir&quot;</span><span class="p">,</span>
  <span class="s2">&quot;filetype&quot;</span><span class="p">:</span> <span class="s2">&quot;mseed&quot;</span><span class="p">,</span>
  <span class="s2">&quot;quakeml_file&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/quakeml/file&quot;</span><span class="p">,</span>
  <span class="s2">&quot;staxml_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/stationxml/dir&quot;</span><span class="p">,</span>
  <span class="s2">&quot;output_file&quot;</span><span class="p">:</span> <span class="s2">&quot;path/to/output/asdf/file&quot;</span><span class="p">,</span>
  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;observed&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">tag</span></tt> is waveform tags required by ASDF.</p>
<p>For synthetic data in SAC, if station location information(laitude, longitude, elevation and depth) is already stored in the header, then you don&#8217;t need external stationxml files. During the conversion, a simple stationxml will be generated in the memory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;waveform_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/synthetic/waveform/dir&quot;</span><span class="p">,</span>
  <span class="s2">&quot;filetype&quot;</span><span class="p">:</span> <span class="s2">&quot;sac&quot;</span><span class="p">,</span>
  <span class="s2">&quot;quakeml_file&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/quakeml/file&quot;</span><span class="p">,</span>
  <span class="s2">&quot;output_file&quot;</span><span class="p">:</span> <span class="s2">&quot;path/to/output/asdf/file&quot;</span><span class="p">,</span>
  <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;synthetic&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then you need to write the data conversion script:</p>
<div class="highlight-python"><div class="highlight"><pre>#!/usr/bin/env python

import argparse
from pypaw import ConvertASDF

if __name__ == &#39;__main__&#39;:

    parser = argparse.ArgumentParser()
    parser.add_argument(&#39;-f&#39;, action=&#39;store&#39;, dest=&#39;path_file&#39;, required=True)
    parser.add_argument(&#39;-v&#39;, action=&#39;store_true&#39;, dest=&#39;verbose&#39;)
    parser.add_argument(&#39;-s&#39;, action=&#39;store_true&#39;, dest=&#39;status_bar&#39;)
                        args = parser.parse_args()

    converter = ConvertASDF(args.path_file, args.verbose, args.status_bar)
    converter.run()
</pre></div>
</div>
<p>Save this as <cite>convert_asdf.py</cite> and you can use it:</p>
<div class="highlight-python"><div class="highlight"><pre>python convert_asdf.py -f convert.obsd.path.json -v -s
</pre></div>
</div>
<p>Examples of data conversion is located at <cite>&#8216;examples/converter&#8217;</cite>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Data Format and Conversion</a><ul>
<li><a class="reference internal" href="#data-format">1. Data Format</a></li>
<li><a class="reference internal" href="#data-conversion">2. Data Conversion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial.html"
                        title="next chapter">Tutorial</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/data_format.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial.html" title="Tutorial"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">pypaw 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Wenjie Lei.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>